model miles

role owner

role[%transferable] validator

asset account identified by account = {
  owner   : owner;
  amount  : uint;
}

transaction add = {
   args = {
     owner : owner;
     val : uint;
   }
   called by validator;
   action : account.update owner { amount += val } { amount = 0 }
}

transaction consume = {
   args : {
     owner : owner;
     val : uint;
   }
   called by validator;
   condition : (account.get owner).amount >= val;

   assert : (before.account.get owner).amount =
            (after.account.get owner).amount + val;

   action : (account.get owner).amount -= val;
}
