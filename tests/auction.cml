model auction

(*variable max_bid tez = 0*)
variable max_bid int = 0

asset bid identified by incumbent = {
  incumbent : address;
  value : tez
}

variable deadline date = 2019-01-01T00:00:00


transaction place_bid = {

 condition now < deadline

 action
   bid.add { incumbent = caller; val = transferred };
   max_bid := max transferred max_bid
}


(* Users need to exhibit proof they are not the winner to reclaim their bid *)
transaction reclaim = {

 condition
   c1 : now < deadline;
   c2 : let bc = bid.get caller in
        bc < max_bid

 action
   transfer (bid.get caller) to caller

}

specification {
  forall a : address,
    bid.contains a -> balance > (bid.get a).val
}
