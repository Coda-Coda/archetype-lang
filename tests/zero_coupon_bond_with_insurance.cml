model zero_coupon_bond_with_insurance

role issuer = @tz1KksC8RvjUWAbXYJuNrUbontHGor25Cztk (* seller ‘Alice’ *)

role owner = @tz1KmuhR6P52hw6xs5P69BXJYAURaznhvN1k
(* buyer ‘Bob’; receives 11 xtz in one-year *)

contract insurance = {
   transaction pay : address tez;
} = @KT1GabhR5P52hw6xs5P69BXJYAURaznhvN1k

variable price xtz from owner = 10

variable payment xtz from issuer to owner = 11

variable maturity date

states =
  | Created initial (* Created phase enables *)
  | Insured         (* Guarantee Fund has accepted issuer *)
  | Confirmed       (* owner has purchased bond *)
  | Transferred

transition insure from Created to Insured = {
    called by insurance;
}

transition confirm from Insured to Confirmed = {
   condition : transferred = price;
   specification = { balance = 0 }
   action = {
     maturity := now + 1y,
     transfer price to issuer
   }
}

transition collect from Confirmed to Transferred = {
   called by owner;
   condition : now > maturity;
   action = {
     if balance >= payment
     then transfer balance to owner
     else insurance.pay owner payment
   }
}
