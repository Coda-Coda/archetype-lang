model zero_coupon_bond_with_insurance

role issuer = @tz1KksC8RvjUWAbXYJuNrUbontHGor25Cztk (* seller ‘Alice’ *)

role owner = @tz1KmuhR6P52hw6xs5P69BXJYAURaznhvN1k
(* buyer ‘Bob’; receives 11 xtz in one-year *)

contract insurance = {
   transaction pay : address tez
} = @KT1GabhR5P52hw6xs5P69BXJYAURaznhvN1k

variable price xtz from owner = 10

variable payment xtz from issuer to owner = 11

variable maturity date

states =
  | Created initial (* Created phase enables *)
  | Insured         (* Guarantee Fund has accepted issuer *)
  | Confirmed       (* owner has purchased bond *)
  | Transferred

transaction insure = {
  called by insurance
  transition from Created to Insured
}

transaction confirm = {
   condition transferred = price
   transition from Insured to Confirmed
   specification
     balance = 0

   action
     maturity := now + 1y;
     transfer price to issuer
}

transaction collect = {
   called by owner
   condition now > maturity
   transition from Confirmed to Transferred
   action
     if balance >= payment
     then transfer balance to owner
     else insurance.pay owner payment
}
