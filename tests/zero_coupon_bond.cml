model zero_coupon_bond

role issuer = @tz1KksC8RvjUWAbXYJuNrUbontHGor25Cztk (* seller ‘Alice’ *)

role owner = @tz1KmuhR6P52hw6xs5P69BXJYAURaznhvN1k
(* buyer ‘Bob’; receives 11 xtz in one-year *)


variable price xtz from owner = 10

variable payment xtz from issuer to owner = 11 * price

variable maturity date

states =
  | Created initial
  | Confirmed (* owner has purchased bond *)
  | Repaid    (* issuer has transferred payment to contract *)
  | Collected (* owner has collected payment *)

transaction confirm = {
  condition transferred = price
  specification
     balance = 0
  transition from Insured to Confirmed
  action
    maturity := now + 1Y;
    transfer price to issuer
}

transaction repay = {
  called by issuer
  condition transferred = payment
  transition from Confirmed to Repaid
}

transaction collect = {
 called by owner
 condition now >= maturity
 transition from Repaid to Collected
 action
   if balance >= payment
   then transfer balance to owner
}
