model zero_coupon_bond

role issuer := @tz1KksC8RvjUWAbXYJuNrUbontHGor25Cztk (* seller ‘Alice’ *)

role owner := @tz1KmuhR6P52hw6xs5P69BXJYAURaznhvN1k
(* buyer ‘Bob’; receives 11 xtz in one-year *)


variable price xtz from owner := 10

variable payment xtz from issuer to owner := 11

variable maturity date

states
  | Created initial (* Created phase enables *)
  | Confirmed       (* owner has purchased bond *)
  | Transferred

transition confirm from Created to Confirmed = {
   condition : transferred = price;
   specification = { balance = 0 }
   action = {
     maturity := now + 1y,
     transfer price to issuer
   }
}

transaction repay = {
   called by issuer;
   condition : transferred = payment;
}

transaction collect = {
   called by owner;
   condition : now > maturity;
   action = {
     if balance >= payment
     then (transfer balance to owner,
           state := Transferred)
   }
}
