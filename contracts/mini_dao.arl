archetype mini_dao

asset shares identified by addr {
  addr : address;
  value : tez
}

action withdraw () {
  specification {
    postcondition p1 {
      balance = before.balance - shares[caller].value
    }
  }
  require {
    r0 : shares.contains(caller);
    r1 : shares[caller].value > 0tz;
    r2 : balance >= shares[caller].value;
  }
  effect {
    let v = shares[caller].value in
    transfer v to caller;
    shares.update (caller, { value = 0tz })
  }
}
