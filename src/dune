(env
  (dev
    (flags (:standard -rectypes -g -w Y -w Z -w -9 -w -23 -w +28 -w +33 -w -32)))
  (release
    (flags (:standard -rectypes))))

(ocamllex lexer)
(menhir (flags --explain) (modules parser))


(library
  (name cmlLib)
  (preprocess
    (pps ppx_deriving.std ppx_deriving_yojson)
  )
  (library_flags (-linkall))
  (modules tools core ident location parseUtils parseTree parser lexer io model modelinfo modelws modelliq printer translate liq_printer)
  (libraries menhirLib why3 ppx_deriving yojson ppx_deriving_yojson.runtime)
)

(library
  (name w3plugin)
  (modules w3plugin)
  (libraries cmlLib)
)

(rule
 (targets cml.cmxs)
 (deps    /home/dev/.opam/cml/lib/easy-format/easy_format.cmxa
          /home/dev/.opam/cml/lib/biniou/biniou.cmxa
          /home/dev/.opam/cml/lib/yojson/yojson.cmxa
          /home/dev/.opam/cml/lib/result/result.cmxa
          /home/dev/.opam/cml/lib/ppx_deriving/ppx_deriving_runtime.cmxa
          /home/dev/.opam/cml/lib/ppx_deriving_yojson/runtime/ppx_deriving_yojson_runtime.cmxa
          cmlLib.cmxa
          w3plugin.cmxa)
 (action  (run ocamlopt -shared -linkall -o %{targets} %{deps})))

(executable
  (modules compiler)
  (libraries cmlLib menhirLib why3)
  (name     compiler))
